---
title: "IST687 - Music Classification Project"
author: "Team 2 - Sebastian Castro, John Fields, Courtney Smith, Jeremy Wallner"
date: "5/13/2019"
output:
  word_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Executive Summary

The purpose of this project is to analyze the Million Song Database to predict "Hot" artists and songs based on the attributes such as familiarity, artist location, loudness, terms used, etc.  The analysis was done using R software on a 10,000 track subset of the data and our model was able to predict "Hot" songs with ~80% accuracy. 

## Table of Contents

Executive Summary
Data
Analysis
Conclusion
Final proofing

## Introduction

## Related Work

Thierry Bertin-Mahieux, Daniel P.W. Ellis, Brian Whitman, and Paul Lamere. 
The Million Song Dataset. In Proceedings of the 12th International Society
for Music Information Retrieval Conference (ISMIR 2011), 2011.

## Dataset
```{r import data}
#New code from Courtney to change from 3 to 5 categories of artist hotness
music <- read.csv("~/Intro data science/Music project/newmusic.csv")
str(music)
colnames(music)[1] <- "artist.hotttnesss"

# New code from Jeremy importing of song list
newmusic <- read.csv("~/Intro data science/Music project/newmusic.csv")
#New code from Jeremy importing of song list
newmusic <- read.csv("~/Intro data science/Music project/newmusic.csv")

head(newmusic)
newmusic2 <- newmusic
newmusic3 <- newmusic2[-c(1:2,4:9,11,13:14,19:20,23,36)]
show(newmusic3)
newmusic3 <- na.omit(newmusic3)
cmbomusic <- newmusic3


##Artist Hotness Histogram
library(ggplot2)
ggplot(music, aes(x=artist.hotttnesss))  + geom_histogram(color="black", fill="steelblue", alpha=0.5) + xlab("Artist Hotness") + ggtitle("Histogram: Artist Hotness")
##Function to create descriptive statistics for artist hotness
descriptive_stats <- function(vector) { library(moments) 
  result <- c(Mean=mean(vector),
              Median=median(vector),
              Min = min(vector),
              Max = max(vector),
              SD = sd(vector),
              Quantile = quantile(vector, probs = c(0.25,.50,0.75, 0.95)),
              Skewness = skewness(vector) )
  print(result) 
}
descriptive_stats(music$artist.hotttnesss)
##Methodology for assigning artist hotness levels - uses quantiles from descriptitive_statistics function
#95% Quantile: 0.6011861 - Hot
#75% Quantile: 0.453858  - Warm
#50% Quantile: 0.3807423 - Tepid
#25% Quantile: 0.3252656 - Cool
##Code for assigning labels based on above quantiles
music$artist.hotness.label <- ifelse(music$artist.hotttnesss >=0.6011861, "Hot",
                                     ifelse(music$artist.hotttnesss >=0.453858 & music$artist.hotttnesss <0.6011861, "Warm",
                                            ifelse(music$artist.hotttnesss >=0.3807423 & music$artist.hotttnesss <0.453858, "Tepid",
                                                   ifelse(music$artist.hotttnesss >=0.3252656 & music$artist.hotttnesss <0.3807423, "Cool",
                                                          ifelse(music$artist.hotttnesss < 0.3252656, "Frigid","Else")))))
unique(music$artist.hotness.label)
#End of new code from Courtney
#Prior to importing, a new column artist.hotttnesss.label was adding with 
#Hot(>.4590), Warm(<.4590 and >.3357), Cold(<.3357).  Four rows with blanks in 
#famiiarity were also deleted.
music <- na.omit(music)
#Copy original data to a new dataframe music1 and exclude unneeded data
music <- music[-c(1:5,7,16,19,21:25,30,34)]
music$artist.hotness.label <- as.factor(music$artist.hotness.label) 
str(music)

##SONG HOTNESS HISTOGRAM From Jeremy
cmbomusic[cmbomusic==0]<- NA
#cmbomusic2 <- cmbomusic[-c(5,6)]
cmbomusic3 <- na.omit(cmbomusic)
cmbomusic3$song.hotttnesss.label <- ifelse( cmbomusic3$song.hotttnesss >=0.6011861, "Hot",ifelse(cmbomusic3$song.hotttnesss >= 0.453858 & cmbomusic3$song.hotttnesss <0.6011861, "Warm", ifelse(cmbomusic3$song.hotttnesss >=0.3807423 & cmbomusic3$song.hotttnesss < 0.453858, "Tepid",ifelse(cmbomusic3$song.hotttnesss >=0.3252656 & cmbomusic3$song.hotttnesss <0.3807423, "Cool",ifelse(cmbomusic3$song.hotttnesss < 0.3252656, "Frigid","Else")))))
unique(cmbomusic3$song.hotttnesss.label)
cmbomusic3 <- cmbomusic3[-c(2:3,12)]
ggplot(cmbomusic3, aes(x=song.hotttnesss))  + geom_histogram(color="black", fill="steelblue", alpha=0.5) + xlab("Song Hotness") + ggtitle("Histogram: Song Hotness")
##Function to create descriptive statistics for song  hotness
descriptive_stats2 <- function(vector) { library(moments) 
  result <- c(Mean=mean(vector),
              Median=median(vector),
              Min = min(vector),
              Max = max(vector),
              SD = sd(vector),
              Quantile = quantile(vector, probs = c(0.25,.50,0.75, 0.95)),
              Skewness = skewness(vector) )
  print(result) 
}
descriptive_stats2(cmbomusic3$song.hotttnesss)

cmbomusic3$song.hotness.label <- ifelse( cmbomusic3$song.hotttnesss >=0.64787976, "Hot",ifelse(cmbomusic3$song.hotttnesss >= 0.43437984  & cmbomusic3$song.hotttnesss <0.64787976, "Warm", ifelse( cmbomusic3$song.hotttnesss <0.43437984, "Cold","Else")))
unique(cmbomusic3$song.hotness.label)


cmbomusic3$song.hotttnesss.label <- as.factor(cmbomusic3$song.hotttnesss.label) 
str(cmbomusic3)

cmbomusic3$song.hotttnesss.label <- ifelse( cmbomusic3$song.hotttnesss >=0.6011861, "Hot",ifelse(cmbomusic3$song.hotttnesss >= 0.453858 & cmbomusic3$song.hotttnesss <0.6011861, "Warm", ifelse(cmbomusic3$song.hotttnesss >=0.3807423 & cmbomusic3$song.hotttnesss < 0.453858, "Tepid",ifelse(cmbomusic3$song.hotttnesss >=0.3252656 & cmbomusic3$song.hotttnesss <0.3807423, "Cool",ifelse(cmbomusic3$song.hotttnesss < 0.3252656, "Frigid","Else")))))
unique(cmbomusic3$song.hotttnesss.label)

cmbomusic3$song.hotttnesss.label <- as.factor(cmbomusic3$song.hotttnesss.label) 
str(cmbomusic3)

cmbomusic3$song.hotttnesss.label <- ifelse( cmbomusic3$song.hotttnesss >=0.6011861, "Hot",ifelse(cmbomusic3$song.hotttnesss >= 0.453858 & cmbomusic3$song.hotttnesss <0.6011861, "Warm", ifelse(cmbomusic3$song.hotttnesss >=0.3807423 & cmbomusic3$song.hotttnesss < 0.453858, "Tepid",ifelse(cmbomusic3$song.hotttnesss >=0.3252656 & cmbomusic3$song.hotttnesss <0.3807423, "Cool",ifelse(cmbomusic3$song.hotttnesss < 0.3252656, "Frigid","Else")))))
unique(cmbomusic3$song.hotttnesss.label)

str(cmbomusic3)

cmbomusic3$song.hotttnesss.label <- as.factor(cmbomusic3$song.hotttnesss.label) 
cmbomusic3$song.hotttnesss.label <- as.factor(cmbomusic3$song.hotttnesss.label) 
str(cmbomusic3)
 #View the number of Cold/Warm/Hot labels 
 table(cmbomusic3$song.hotttnesss.label)

 cmbomusic3$song.hotness.label <- ifelse( cmbomusic3$song.hotttnesss >=0.64787976, "Hot",ifelse(cmbomusic3$song.hotttnesss >= 0.43437984  & cmbomusic3$song.hotttnesss <0.64787976, "Warm", ifelse( cmbomusic3$song.hotttnesss <0.43437984, "Cold","Else")))
unique(cmbomusic3$song.hotness.label)

```
## Features

```{r features}
#View the number of Cold/Warm/Hot labels 
table(music$artist.hotttnesss.label)
#View the number of Frigid/Cool/Tepid/Warm/Hot labels 
table(music$artist.hotness.label)
#Plot artists latitude and longitude
plot(music$latitude,music$longitude)

cmbomusic3$song.hotness.label <- as.factor(cmbomusic3$song.hotness.label) 
cmbomusic3$song.hotness.label <- as.factor(cmbomusic3$song.hotness.label) 
str(cmbomusic3)
#View the number of Cold/Warm/Hot labels 
table(cmbomusic3$song.hotness.label)
#View the number of Frigid/Cool/Tepid/Warm/Hot labels 
 table(cmbomusic3$song.hotttnesss.label)
 #Plot artists latitude and longitude
 plot(cmbomusic3$latitude,cmbomusic3$longitude)
#Plot artist hotttnesss
#hist(music$artist.hotttnesss,breaks=20)
#hist(music$artist.hotness,breaks=20)
```
#THIS IS INCOMPLETE CODE FOR PLOTTING ADDITIONAL DATA...
#Create a map of the world
mapWorld <- borders("world", colour="gray50", fill="white")

#Code from https://rpubs.com/spoonerf/global_map
#Need to figure out what to put in locs
locs<-read.csv("my_locations.csv")
locs<-
sp_dups<-data.frame(ddply(locs,.(Longitude,Latitude),nrow))
sp_dups$loc_id<-1:length(sp_dups$Longitude)
sp_dups_df<-merge(sp_dups, locs, by=c("Longitude","Latitude"))

loc<-data.frame(sp_dups_df$Longitude,sp_dups_df$Latitude,sp_dups_df$V1)
loc<-unique(loc)
colnames(loc)<-c("Longitude", "Latitude", "V1")

coordinates(loc)<-c("Longitude","Latitude")
proj4string(loc) <- CRS("+proj=longlat")

loc_df<-data.frame(loc)

theme_opts <- list(theme(panel.grid.minor = element_blank(),
                         panel.grid.major = element_blank(),
                         panel.background = element_blank(),
                         plot.background = element_rect(fill="white"),
                         panel.border = element_blank(),
                         axis.line = element_blank(),
                         axis.text.x = element_blank(),
                         axis.text.y = element_blank(),
                         axis.ticks = element_blank(),
                         axis.title.x = element_blank(),
                         axis.title.y = element_blank(),
                         plot.title = element_text(size=22)))

library(maps)
library(mapdata)

ggplot(data=loc_df, aes(Longitude, Latitude, group=NULL,fill=NULL,size=V1))+#, fill=hole)) + 
  borders(fill="light grey",colour="light grey")+
  geom_point(color="black",alpha=I(7/10))+
  scale_size(range=c(1,7), guide = "legend",labs(size="No. of Populations"))+
  coord_equal()+
  theme_opts
  
## Methods
```{r methods}
#Do analysis to determine hot/warm/cold artists based on hotttnesss
#The ramdom forest analysis is from a training video by Bharatendra Rai 
#at https://www.youtube.com/watch?v=dJclNIN-TPo
#Data Partition - ind = independent samples
#The code below runs in console but not R Markdown
set.seed(123)
ind<- sample(2,nrow(music), replace=TRUE,prob=c(0.7,0.3))
train <- music[ind==1,]
test <- music[ind==2,]
#Run randomForest on 3 levels
library(randomForest)
set.seed(222)
rf <- randomForest(music[,-21:-22],music[,21])
print(rf)
attributes(rf)
rf$confusion
#Run randomForest on 5 levels
library(randomForest)
set.seed(222)
rf2 <- randomForest(music[,-21:-22],music[,22])
print(rf2)
attributes(rf2)
rf2$confusion
#Run randomForest again with tune mtry data from below
#rfx <- randomForest(artist.hotness.label ~.,data=music,ntree=200,mtry=8,importance=TRUE,proximity=TRUE)
#Prediction & Confusion Matrix - train data
#library(caret)
#p1<-predict(rfx,train)
#confusionMatrix(p1,train)
#Predition & Confusion Matrix - test data
#p2<-predict(rfx,test)
#confusionMatrix(p2,test$artist.hotness.label)
#Error rate of Random Forest
plot(rf)
plot(rf2)
#The error rate is not improving after ~100 trees
#Tune mtry
#t <- tuneRF(train[,-21],train[,21],
#           stepFactor=.5,
#            plot=TRUE,
#            ntreeTry=200,
#            trace=TRUE,
#            improve=0.05)
#No. of nodes for the trees
hist(treesize(rf),
    main="Number of Nodes for the Trees",
    col="green")
hist(treesize(rf2),
    main="Number of Nodes for the Trees",
    col="green")
# Variable Importance
# Familiarity is much more important than the other variables.  Should it be removed and run again?
varImpPlot(rf,
           sort=T,
           n.var=10,
           main="Top 10 - Variable Importance")
importance(rf)
varUsed(rf)
varImpPlot(rf2,
           sort=T,
           n.var=10,
           main="Top 10 - Variable Importance")
importance(rf2)
varUsed(rf2)
#Mulit-dimenstional Scaling Plot
#The code below causes R to lock up...
#MDSplot(rf,train$artist.hotttnesss.label)


cmbomusic4 <- na.omit(cmbomusic3)
cmbomusic5 <- cmbomusic4[-c(1,3,7:9,13,17,20)]
str(cmbomusic5)
cmbomusic5$song.hotness.label <- as.factor(cmbomusic4$song.hotness.label) 
rf3 <- randomForest(cmbomusic5[,-12:-13],cmbomusic5[,13])
rf3
print(rf3)
attributes(rf3)
rf3$confusion
plot(rf3)


hist(treesize(rf3),
    main="Number of Nodes for the Trees",
    col="blue")
varImpPlot(rf3,
           sort=T,
           n.var=10,
           main="Top 10 - Variable Importance")
```
## Results

## Conclusion

## Appendices